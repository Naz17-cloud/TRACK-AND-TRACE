<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f0f2f5;
  margin: 0;
  padding: 20px;
}
h2 {
  text-align: center;
  color: #333;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
}
th, td {
  padding: 10px;
  text-align: left;
}
th {
  background-color: #007BFF;
  color: white;
}
td {
  background-color: rgba(255,255,255,0.8);
}
tbody tr {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeRow 0.4s ease forwards;
}
tbody tr:hover {
  transform: scale(1.01);
  transition: transform 0.2s ease;
}
.editable:focus {
  background-color: rgba(255, 255, 0, 0.3);
  outline: none;
}
button {
  margin: 5px 0;
  padding: 8px 15px;
  background-color: #007BFF;
  border: none;
  color: white;
  border-radius: 5px;
  cursor: pointer;
}
button:hover {
  background-color: #0056b3;
}
@keyframes fadeRow {
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>
<h2>Admin Panel</h2>
<button id="exportCSV">Export CSV</button>
<button id="exportExcel">Export Excel</button>
<table id="dataTable">
  <thead>
    <tr>
      <th>Bill of Lading</th>
      <th>Vessel/Voyage</th>
      <th>ETA</th>
      <th>Port Transit</th>
      <th>Connecting Vessel</th>
      <th>Port Destination</th>
      <th>ETD</th>
      <th>ETA POD</th>
      <th>DO Release Date</th>
      <th>Cargo Release Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "AUTH_DOMAIN",
  projectId: "PROJECT_ID",
  storageBucket: "STORAGE_BUCKET",
  messagingSenderId: "MSG_SENDER_ID",
  appId: "APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadData() {
  const tableBody = document.querySelector("#dataTable tbody");
  tableBody.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "shipments"));
  querySnapshot.forEach((docSnap, index) => {
    const data = docSnap.data();
    const row = document.createElement("tr");
    Object.keys(data).forEach((key) => {
      const cell = document.createElement("td");
      cell.contentEditable = true;
      cell.classList.add("editable");
      cell.innerText = data[key] || "";
      row.appendChild(cell);
    });
    const actionCell = document.createElement("td");
    const saveBtn = document.createElement("button");
    saveBtn.innerText = "Save";
    saveBtn.onclick = async () => {
      const cells = row.querySelectorAll("td.editable");
      const updatedData = {};
      Object.keys(data).forEach((key, idx) => {
        updatedData[key] = cells[idx].innerText;
      });
      await updateDoc(doc(db, "shipments", docSnap.id), updatedData);
      alert("Data berhasil disimpan!");
    };
    actionCell.appendChild(saveBtn);
    row.appendChild(actionCell);
    row.style.animationDelay = `${index * 0.05}s`;
    tableBody.appendChild(row);
  });
}

function exportTableToCSV(filename) {
  const rows = document.querySelectorAll("table tr");
  const csv = [];
  rows.forEach(row => {
    const cols = row.querySelectorAll("td, th");
    const rowData = [];
    cols.forEach(col => rowData.push(`"${col.innerText}"`));
    csv.push(rowData.join(","));
  });
  const csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
  const downloadLink = document.createElement("a");
  downloadLink.download = filename;
  downloadLink.href = window.URL.createObjectURL(csvFile);
  downloadLink.click();
}

document.getElementById("exportCSV").addEventListener("click", () => {
  exportTableToCSV("shipments.csv");
});
document.getElementById("exportExcel").addEventListener("click", () => {
  exportTableToCSV("shipments.xls");
});

loadData();
</script>
</body>
</html>
