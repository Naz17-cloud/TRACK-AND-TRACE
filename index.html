<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Shipment Tracking</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; margin: 5px 0; }
    .shipment { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Tracking Shipment</h2>
  <input type="text" id="searchInput" placeholder="Masukkan Nomor BL atau Container">
  <button onclick="searchShipment()">Cari</button>
  <div id="results"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBwIvGNogDk6nKCCcoWxmnvex4pbSIR07g",
      authDomain: "track-and-trace-ca19a.firebaseapp.com",
      projectId: "track-and-trace-ca19a",
      storageBucket: "track-and-trace-ca19a.appspot.com",
      messagingSenderId: "264766950053",
      appId: "1:264766950053:web:b871670f2ab2c10d0f1b4c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function searchShipment() {
      const searchValue = document.getElementById('searchInput').value.trim();
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = "Mencari...";

      const q1 = query(collection(db, "shipments"), where("blNumber", "==", searchValue));
      const q2 = query(collection(db, "shipments"), where("containerNumber", "==", searchValue));

      let found = false;
      for (const q of [q1, q2]) {
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          resultsDiv.innerHTML = `
            <div class="shipment">
              <strong>BL:</strong> ${data.blNumber} <br>
              <strong>Container:</strong> ${data.containerNumber} <br>
              <strong>Type:</strong> ${data.type} <br>
              <strong>Origin:</strong> ${data.origin} <br>
              <strong>Destination:</strong> ${data.destination} <br>
              <strong>Status:</strong> ${data.status || 'N/A'}
            </div>
          `;
          found = true;
        });
      }
      if (!found) resultsDiv.innerHTML = "Data tidak ditemukan.";
    }
    window.searchShipment = searchShipment;
  </script>
</body>
</html>
