<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Data Import Tracking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    margin: 20px;
    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }
  .overlay {
    background-color: rgba(0,0,0,0.5);
    min-height: 100vh;
    padding: 30px;
    border-radius: 8px;
  }
  h2 {
    color: #ffcc80;
    text-align: center;
    margin-bottom: 5px;
    font-weight: 600;
  }
  .watermark {
    text-align: center;
    font-size: 12px;
    opacity: 0.7;
    margin-bottom: 20px;
  }
  /* Buttons */
  .btn {
    padding: 5px 10px;
    border-radius: 5px;
    border: none;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    margin: 3px;
  }
  .btn-primary { background-color: #ff9800; color: white; }
  .btn-primary:hover { background-color: #e68900; }
  .btn-success { background-color: #4caf50; color: white; }
  .btn-success:hover { background-color: #388e3c; }
  /* Dropdown */
  .dropdown { position: relative; display: inline-block; }
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #fff;
    min-width: 120px;
    box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
    z-index: 1;
    border-radius: 5px;
    overflow: hidden;
  }
  .dropdown-content button {
    background: none;
    color: #333;
    padding: 8px 12px;
    text-align: left;
    border: none;
    width: 100%;
    font-size: 12px;
    cursor: pointer;
  }
  .dropdown-content button:hover { background-color: #eee; }
  .dropdown:hover .dropdown-content { display: block; }
  /* Search */
  #filters { max-width: 500px; margin: 0 auto 15px; text-align: center; }
  #filters input {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: none;
    font-size: 14px;
    margin-bottom: 10px;
  }
  /* Table */
  table {
    border-collapse: collapse;
    width: 100%;
    font-size: 13px;
    border-radius: 10px;
    overflow: hidden;
    background: rgba(255,255,255,0.95);
    color: #333;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  th {
    background: linear-gradient(90deg, rgba(60,120,180,1) 0%, rgba(40,100,160,1) 100%);
    color: white;
    padding: 8px;
    text-align: left;
    font-size: 12px;
  }
  td { padding: 6px; }
  tr:nth-child(even) td { background-color: #f8f8f8; }
  tr:hover td { background-color: #e6f2ff; }
  .editable { background-color: #fff9e0; border-radius: 3px; }
  .delete-btn {
    cursor: pointer;
    color: #ff5722;
    font-weight: bold;
    font-size: 14px;
    margin-left: 5px;
  }
  /* Smaller Progress & Action columns */
  th:nth-last-child(2), td:nth-last-child(2) {
    width: 90px;
    text-align: center;
  }
  th:last-child, td:last-child {
    width: 85px;
    text-align: center;
  }
  td button {
    padding: 3px 6px;
    font-size: 11px;
  }
  .logo {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 100px;
    animation: logoAnim 1.5s ease-in-out infinite alternate;
  }
  @keyframes logoAnim {
    0% { transform: scale(1) rotate(0deg); opacity: 0.8; }
    50% { transform: scale(1.05) rotate(2deg); opacity: 1; }
    100% { transform: scale(1) rotate(-2deg); opacity: 0.9; }
  }
</style>
</head>
<body>
<div class="overlay">
  <h2>Data Import Tracking</h2>
  <div class="watermark">by nazrll</div>

  <div id="loginSection">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn" class="btn btn-primary">Login</button>
  </div>

  <div id="adminSection" style="display:none;">
    <button id="logoutBtn" class="btn btn-primary">Logout</button>
    <button id="addRowBtn" class="btn btn-primary">+ Tambah Data</button>
    
    <div class="dropdown">
      <button class="btn btn-success">Export Data ▾</button>
      <div class="dropdown-content">
        <button id="exportExcel">Excel</button>
        <button id="exportCSV">CSV</button>
      </div>
    </div>

    <div class="dropdown">
      <button class="btn btn-primary">Filter Progress ▾</button>
      <div class="dropdown-content">
        <button id="filterAll">Semua</button>
        <button id="filterDone">Selesai</button>
        <button id="filterPending">Belum Selesai</button>
      </div>
    </div>

    <div id="filters">
      <input type="text" placeholder="Cari POL, POD, atau Incoterm" id="mainSearch">
    </div>

    <table id="importTable">
      <thead>
        <tr>
          <th>POL</th>
          <th>POD</th>
          <th>ETD</th>
          <th>ETA</th>
          <th>Incoterm</th>
          <th>Type of Shipment</th>
          <th>Progress</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<img src="logo.png" alt="Logo" class="logo">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginSection = document.getElementById("loginSection");
const adminSection = document.getElementById("adminSection");
const tableBody = document.querySelector("#importTable tbody");

document.getElementById("loginBtn").addEventListener("click", () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
    .catch(err => alert("Login gagal: " + err.message));
});
document.getElementById("logoutBtn").addEventListener("click", () => signOut(auth));

onAuthStateChanged(auth, user => {
  if (user) {
    loginSection.style.display = "none";
    adminSection.style.display = "block";
    loadData();
  } else {
    loginSection.style.display = "block";
    adminSection.style.display = "none";
  }
});

async function loadData() {
  tableBody.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "importShipments"));
  querySnapshot.forEach(docSnap => addRow(docSnap.id, docSnap.data()));
}

function addRow(id, data) {
  const tr = document.createElement("tr");
  const fields = ["pol","pod","etd","eta","incoterm","typeOfShipment"];
  fields.forEach(field => {
    const td = document.createElement("td");
    td.textContent = data[field] || "";
    td.contentEditable = true;
    td.classList.add("editable");
    tr.appendChild(td);
  });

  const progressTd = document.createElement("td");
  const isComplete = fields.every(f => (data[f] || "").trim() !== "");
  progressTd.textContent = isComplete ? "✅" : "❌";
  progressTd.dataset.status = isComplete ? "done" : "pending";
  progressTd.style.color = isComplete ? "green" : "red";
  tr.appendChild(progressTd);

  const actionTd = document.createElement("td");
  const saveBtn = document.createElement("button");
  saveBtn.textContent = "Save";
  saveBtn.classList.add("btn","btn-primary");
  saveBtn.addEventListener("click", async () => {
    const updatedData = {};
    fields.forEach((field, index) => {
      updatedData[field] = tr.cells[index].textContent.trim();
    });
    await updateDoc(doc(db, "importShipments", id), updatedData);
    alert("Data berhasil disimpan!");
    loadData();
  });

  const deleteBtn = document.createElement("span");
  deleteBtn.textContent = "🗑";
  deleteBtn.classList.add("delete-btn");
  deleteBtn.addEventListener("click", async () => {
    if (confirm("Hapus data ini?")) {
      await deleteDoc(doc(db, "importShipments", id));
      loadData();
    }
  });

  actionTd.appendChild(saveBtn);
  actionTd.appendChild(deleteBtn);
  tr.appendChild(actionTd);
  tableBody.appendChild(tr);
}

document.getElementById("addRowBtn").addEventListener("click", async () => {
  await addDoc(collection(db, "importShipments"), {
    pol: "", pod: "", etd: "", eta: "", incoterm: "", typeOfShipment: ""
  });
  loadData();
});

document.getElementById("mainSearch").addEventListener("keyup", function () {
  const filter = this.value.toLowerCase();
  Array.from(tableBody.rows).forEach(row => {
    const pol = row.cells[0].textContent.toLowerCase();
    const pod = row.cells[1].textContent.toLowerCase();
    const incoterm = row.cells[4].textContent.toLowerCase();
    row.style.display = (pol.includes(filter) || pod.includes(filter) || incoterm.includes(filter)) ? "" : "none";
  });
});

document.getElementById("filterAll").addEventListener("click", () => {
  Array.from(tableBody.rows).forEach(row => row.style.display = "");
});
document.getElementById("filterDone").addEventListener("click", () => {
  Array.from(tableBody.rows).forEach(row => row.style.display = row.cells[6].dataset.status === "done" ? "" : "none");
});
document.getElementById("filterPending").addEventListener("click", () => {
  Array.from(tableBody.rows).forEach(row => row.style.display = row.cells[6].dataset.status === "pending" ? "" : "none");
});

document.getElementById("exportExcel").addEventListener("click", () => exportTableToExcel("importTable", "import_data"));
document.getElementById("exportCSV").addEventListener("click", () => exportTableToCSV("import_data.csv"));

function exportTableToExcel(tableID, filename = "") {
  const dataType = 'application/vnd.ms-excel';
  const tableSelect = document.getElementById(tableID);
  const tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
  filename = filename ? filename + '.xls' : 'excel_data.xls';
  const downloadLink = document.createElement("a");
  document.body.appendChild(downloadLink);
  downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
  downloadLink.download = filename;
  downloadLink.click();
}

function exportTableToCSV(filename) {
  const csv = [];
  const rows = document.querySelectorAll("table tr");
  rows.forEach(row => {
    const cols = row.querySelectorAll("td, th");
    const rowData = Array.from(cols).map(col => col.innerText);
    csv.push(rowData.join(","));
  });
  const csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
  const downloadLink = document.createElement("a");
  downloadLink.download = filename;
  downloadLink.href = window.URL.createObjectURL(csvFile);
  downloadLink.click();
}
</script>
</body>
</html>
